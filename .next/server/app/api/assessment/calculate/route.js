"use strict";(()=>{var e={};e.id=56,e.ids=[56],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},98216:e=>{e.exports=require("net")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},82452:e=>{e.exports=require("tls")},17360:e=>{e.exports=require("url")},71568:e=>{e.exports=require("zlib")},17128:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>y,patchFetch:()=>_,requestAsyncStorage:()=>l,routeModule:()=>d,serverHooks:()=>g,staticGenerationAsyncStorage:()=>m});var s={};t.r(s),t.d(s,{POST:()=>p});var a=t(49303),o=t(88716),i=t(60670),n=t(87070),c=t(1926),u=t(57559);async function p(e){try{let r=await e.json();if(!r.userId)return n.NextResponse.json({error:"User ID is required"},{status:400});let t=await u.Dc.calculateFundabilityScore(r),{data:s,error:a}=await c.O.from("advanced_fundability_assessments").insert({user_id:r.userId,overall_score:Math.round(t.percentage),category_scores:t.categoryScores.reduce((e,r)=>(e[r.category.toLowerCase().replace(/\s+/g,"_")]=Math.round(r.percentage),e),{}),completion_percentage:100,assessment_version:"3.0",status:"completed",recommendations:t.recommendations,improvement_areas:t.recommendations.filter(e=>"critical"===e.priority||"high"===e.priority).map(e=>e.title),strengths:t.categoryScores.filter(e=>e.percentage>=80).map(e=>e.category),metadata:{fundabilityGrade:t.fundabilityGrade,improvementPotential:t.improvementPotential,assessmentType:"ai_driven",businessType:r.businessType,industry:r.industry}}).select().single();if(a)throw a;let o=t.categoryScores.map((e,t)=>({assessment_id:s.id,category_id:`cat_${t+1}`,category_name:e.category,score:Math.round(e.percentage),max_score:100,completed_criteria:e.completedCriteria,total_criteria:e.totalCriteria,answers:r.responses})),{error:i}=await c.O.from("category_performances").insert(o);i&&console.error("Error saving categories:",i);let{error:p}=await c.O.from("score_history").insert({user_id:r.userId,assessment_id:s.id,overall_score:Math.round(t.percentage),category_scores:t.categoryScores.reduce((e,r)=>(e[r.category]=Math.round(r.percentage),e),{}),assessment_date:new Date().toISOString().split("T")[0],score_change:0});p&&console.error("Error saving history:",p);let{error:d}=await c.O.from("users").update({fundability_score:Math.round(t.percentage),updated_at:new Date().toISOString()}).eq("id",r.userId);return d&&console.error("Error updating user score:",d),n.NextResponse.json({success:!0,assessment:{id:s.id,...t,savedAt:s.created_at}})}catch(e){return console.error("Error calculating assessment:",e),n.NextResponse.json({error:"Failed to calculate assessment"},{status:500})}}let d=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/assessment/calculate/route",pathname:"/api/assessment/calculate",filename:"route",bundlePath:"app/api/assessment/calculate/route"},resolvedPagePath:"C:\\Users\\dondr\\ybw-funds-platform\\ybw-funds-platform\\src\\app\\api\\assessment\\calculate\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:l,staticGenerationAsyncStorage:m,serverHooks:g}=d,y="/api/assessment/calculate/route";function _(){return(0,i.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:m})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[276,972,438,331],()=>t(17128));module.exports=s})();