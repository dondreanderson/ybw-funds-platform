(()=>{var e={};e.id=56,e.ids=[56],e.modules={20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{"use strict";e.exports=require("buffer")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},32615:e=>{"use strict";e.exports=require("http")},35240:e=>{"use strict";e.exports=require("https")},98216:e=>{"use strict";e.exports=require("net")},68621:e=>{"use strict";e.exports=require("punycode")},76162:e=>{"use strict";e.exports=require("stream")},82452:e=>{"use strict";e.exports=require("tls")},17360:e=>{"use strict";e.exports=require("url")},71568:e=>{"use strict";e.exports=require("zlib")},58359:()=>{},93739:()=>{},17128:(e,s,r)=>{"use strict";r.r(s),r.d(s,{originalPathname:()=>f,patchFetch:()=>v,requestAsyncStorage:()=>h,routeModule:()=>m,serverHooks:()=>g,staticGenerationAsyncStorage:()=>y});var t={};r.r(t),r.d(t,{GET:()=>d,POST:()=>p});var a=r(49303),n=r(88716),o=r(60670),i=r(87070),c=r(72438),u=r(57559);let l=(0,c.eI)("https://fzvtzzzsoccptvgihxfl.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY);async function p(e){try{let s=await e.json();if(!s.userId||!s.responses)return i.NextResponse.json({error:"Missing required fields: userId and responses"},{status:400});let r=await u.dH.calculateAdvancedScore(s.responses),t=null;s.industry&&(t=await u.dH.getIndustryComparison(r.overallScore,s.industry));let a=await u.dH.generateRecommendations(r.categoryScores,s.industry),n={user_id:s.userId,overall_score:r.overallScore,category_scores:r.categoryScores,completion_percentage:100,recommendations:a,improvement_areas:r.improvements,strengths:r.strengths,industry_comparison:t,assessment_date:new Date().toISOString(),assessment_version:"3.0",status:"completed",metadata:{assessment_type:s.assessmentType||"advanced",industry:s.industry,responses:s.responses}},{data:o,error:c}=await l.from("advanced_fundability_assessments").insert([n]).select().single();if(c)return console.error("Database error:",c),i.NextResponse.json({error:"Failed to save assessment"},{status:500});return i.NextResponse.json({success:!0,data:{id:o.id,overallScore:r.overallScore,categoryScores:r.categoryScores,recommendations:a,strengths:r.strengths,improvements:r.improvements,industryComparison:t}})}catch(e){return console.error("Assessment calculation error:",e),i.NextResponse.json({error:"Failed to calculate assessment"},{status:500})}}async function d(e){try{let{searchParams:s}=new URL(e.url),r=s.get("userId");if(!r)return i.NextResponse.json({error:"User ID is required"},{status:400});let{data:t,error:a}=await l.from("advanced_fundability_assessments").select("*").eq("user_id",r).order("created_at",{ascending:!1}).limit(10);if(a)return console.error("Database error:",a),i.NextResponse.json({error:"Failed to retrieve assessments"},{status:500});return i.NextResponse.json({success:!0,data:t||[]})}catch(e){return console.error("Get assessments error:",e),i.NextResponse.json({error:"Failed to retrieve assessments"},{status:500})}}let m=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/assessment/calculate/route",pathname:"/api/assessment/calculate",filename:"route",bundlePath:"app/api/assessment/calculate/route"},resolvedPagePath:"C:\\Users\\dondr\\ybw-funds-platform\\ybw-funds-platform\\src\\app\\api\\assessment\\calculate\\route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:h,staticGenerationAsyncStorage:y,serverHooks:g}=m,f="/api/assessment/calculate/route";function v(){return(0,o.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:y})}},57559:(e,s,r)=>{"use strict";r.d(s,{dH:()=>n});let t=(0,r(72438).eI)("https://fzvtzzzsoccptvgihxfl.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ6dnR6enpzb2NjcHR2Z2loeGZsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTExNTAwNjksImV4cCI6MjA2NjcyNjA2OX0.UFY3vSerY963T2cqbgrhstgZfhkgfN5KN7lZUVZ8DLA"),a=(e,s)=>e>=s.percentile_90?90:e>=s.percentile_75?75:e>=s.percentile_50?50:e>=s.percentile_25?25:10;class n{static async calculateAdvancedScore(e){try{let s=0,r={},t=[],a=[],n=[];Object.entries(e).forEach(([e,o])=>{if("boolean"==typeof o){let i=o?20:0;r[e]=i,s+=i,o?a.push(`Strong ${e.replace("_"," ")}`):(n.push(`Improve ${e.replace("_"," ")}`),t.push(`Focus on improving ${e.replace("_"," ")}`))}else if("string"==typeof o){let t=o.length>0?15:0;r[e]=t,s+=t}});let o=20*Object.keys(e).length;return{overallScore:s=Math.min(100,Math.round(s/o*100)),categoryScores:r,recommendations:t,strengths:a,improvements:n}}catch(e){throw console.error("AI Scoring error:",e),Error("Failed to calculate advanced score")}}static async getIndustryComparison(e,s){try{let{data:r,error:n}=await t.from("industry_benchmarks").select("*").eq("industry_name",s).single();if(n||!r)return console.log("No industry benchmark found for:",s),null;return{percentile:a(e,r),industryAverage:r.avg_total_score,comparison:e>r.avg_total_score?"above":"below"}}catch(e){return console.error("Industry comparison error:",e),null}}static async generateRecommendations(e,s){try{let r=[];return Object.entries(e).forEach(([e,s])=>{if(s<50)switch(e){case"business_registration":r.push("Complete business registration and obtain necessary licenses");break;case"credit_profile":r.push("Improve business credit score and establish credit history");break;case"financial_documentation":r.push("Organize financial statements and maintain accurate records");break;case"operational_infrastructure":r.push("Establish professional business operations and systems");break;case"online_presence":r.push("Build strong online presence and digital marketing");break;case"risk_compliance":r.push("Ensure compliance with industry regulations and reduce risk factors");break;default:r.push(`Improve ${e.replace("_"," ")} to enhance fundability`)}}),s&&r.push(`Consider industry-specific funding opportunities for ${s}`),r.slice(0,10)}catch(e){return console.error("Recommendation generation error:",e),["Review your assessment results and focus on areas with lower scores"]}}}}};var s=require("../../../../webpack-runtime.js");s.C(e);var r=e=>s(s.s=e),t=s.X(0,[276,169],()=>r(17128));module.exports=t})();