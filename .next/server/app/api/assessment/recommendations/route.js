(()=>{var e={};e.id=16,e.ids=[16],e.modules={20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{"use strict";e.exports=require("buffer")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},32615:e=>{"use strict";e.exports=require("http")},35240:e=>{"use strict";e.exports=require("https")},98216:e=>{"use strict";e.exports=require("net")},68621:e=>{"use strict";e.exports=require("punycode")},76162:e=>{"use strict";e.exports=require("stream")},82452:e=>{"use strict";e.exports=require("tls")},17360:e=>{"use strict";e.exports=require("url")},71568:e=>{"use strict";e.exports=require("zlib")},58359:()=>{},93739:()=>{},77395:(e,s,r)=>{"use strict";r.r(s),r.d(s,{originalPathname:()=>y,patchFetch:()=>b,requestAsyncStorage:()=>f,routeModule:()=>m,serverHooks:()=>g,staticGenerationAsyncStorage:()=>h});var t={};r.r(t),r.d(t,{GET:()=>p,POST:()=>l});var n=r(49303),o=r(88716),a=r(60670),i=r(87070),c=r(72438),u=r(57559);let d=(0,c.eI)("https://fzvtzzzsoccptvgihxfl.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY);async function l(e){try{let s;let r=await e.json(),t={};if(r.assessmentId){let{data:e,error:n}=await d.from("advanced_fundability_assessments").select("category_scores, metadata").eq("id",r.assessmentId).single();if(n)return i.NextResponse.json({error:"Assessment not found"},{status:404});t=e.category_scores||{},s=e.metadata?.industry}else{if(!r.categoryScores)return i.NextResponse.json({error:"Either assessmentId or categoryScores must be provided"},{status:400});t=r.categoryScores,s=r.industry}let n=await u.dH.generateRecommendations(t,s),o=null;if(s){let e=Object.values(t).reduce((e,s)=>e+s,0)/Object.keys(t).length;o=await u.dH.getIndustryComparison(e,s)}return i.NextResponse.json({success:!0,data:{recommendations:n,categoryScores:t,industry:s,industryComparison:o}})}catch(e){return console.error("Recommendations generation error:",e),i.NextResponse.json({error:"Failed to generate recommendations"},{status:500})}}async function p(e){try{let{searchParams:s}=new URL(e.url),r=s.get("assessmentId"),t=s.get("userId");if(!r&&!t)return i.NextResponse.json({error:"Either assessmentId or userId is required"},{status:400});let n=d.from("assessment_recommendations").select("*");if(r)n=n.eq("assessment_id",r);else if(t){let{data:e,error:s}=await d.from("advanced_fundability_assessments").select("id").eq("user_id",t).order("created_at",{ascending:!1}).limit(1).single();if(s)return i.NextResponse.json({error:"No assessments found for user"},{status:404});n=n.eq("assessment_id",e.id)}let{data:o,error:a}=await n.order("priority",{ascending:!0});if(a)return console.error("Database error:",a),i.NextResponse.json({error:"Failed to retrieve recommendations"},{status:500});return i.NextResponse.json({success:!0,data:o||[]})}catch(e){return console.error("Get recommendations error:",e),i.NextResponse.json({error:"Failed to retrieve recommendations"},{status:500})}}let m=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/assessment/recommendations/route",pathname:"/api/assessment/recommendations",filename:"route",bundlePath:"app/api/assessment/recommendations/route"},resolvedPagePath:"C:\\Users\\dondr\\ybw-funds-platform\\ybw-funds-platform\\src\\app\\api\\assessment\\recommendations\\route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:f,staticGenerationAsyncStorage:h,serverHooks:g}=m,y="/api/assessment/recommendations/route";function b(){return(0,a.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:h})}},57559:(e,s,r)=>{"use strict";r.d(s,{dH:()=>o});let t=(0,r(72438).eI)("https://fzvtzzzsoccptvgihxfl.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ6dnR6enpzb2NjcHR2Z2loeGZsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTExNTAwNjksImV4cCI6MjA2NjcyNjA2OX0.UFY3vSerY963T2cqbgrhstgZfhkgfN5KN7lZUVZ8DLA"),n=(e,s)=>e>=s.percentile_90?90:e>=s.percentile_75?75:e>=s.percentile_50?50:e>=s.percentile_25?25:10;class o{static async calculateAdvancedScore(e){try{let s=0,r={},t=[],n=[],o=[];Object.entries(e).forEach(([e,a])=>{if("boolean"==typeof a){let i=a?20:0;r[e]=i,s+=i,a?n.push(`Strong ${e.replace("_"," ")}`):(o.push(`Improve ${e.replace("_"," ")}`),t.push(`Focus on improving ${e.replace("_"," ")}`))}else if("string"==typeof a){let t=a.length>0?15:0;r[e]=t,s+=t}});let a=20*Object.keys(e).length;return{overallScore:s=Math.min(100,Math.round(s/a*100)),categoryScores:r,recommendations:t,strengths:n,improvements:o}}catch(e){throw console.error("AI Scoring error:",e),Error("Failed to calculate advanced score")}}static async getIndustryComparison(e,s){try{let{data:r,error:o}=await t.from("industry_benchmarks").select("*").eq("industry_name",s).single();if(o||!r)return console.log("No industry benchmark found for:",s),null;return{percentile:n(e,r),industryAverage:r.avg_total_score,comparison:e>r.avg_total_score?"above":"below"}}catch(e){return console.error("Industry comparison error:",e),null}}static async generateRecommendations(e,s){try{let r=[];return Object.entries(e).forEach(([e,s])=>{if(s<50)switch(e){case"business_registration":r.push("Complete business registration and obtain necessary licenses");break;case"credit_profile":r.push("Improve business credit score and establish credit history");break;case"financial_documentation":r.push("Organize financial statements and maintain accurate records");break;case"operational_infrastructure":r.push("Establish professional business operations and systems");break;case"online_presence":r.push("Build strong online presence and digital marketing");break;case"risk_compliance":r.push("Ensure compliance with industry regulations and reduce risk factors");break;default:r.push(`Improve ${e.replace("_"," ")} to enhance fundability`)}}),s&&r.push(`Consider industry-specific funding opportunities for ${s}`),r.slice(0,10)}catch(e){return console.error("Recommendation generation error:",e),["Review your assessment results and focus on areas with lower scores"]}}}}};var s=require("../../../../webpack-runtime.js");s.C(e);var r=e=>s(s.s=e),t=s.X(0,[276,972,438],()=>r(77395));module.exports=t})();