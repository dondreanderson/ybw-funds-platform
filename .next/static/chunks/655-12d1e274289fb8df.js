"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[655],{3655:function(e,t,r){r.d(t,{WB:function(){return o},KD:function(){return a},UI:function(){return i}}),r(2265);let s=(0,r(6580).eI)("https://fzvtzzzsoccptvgihxfl.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ6dnR6enpzb2NjcHR2Z2loeGZsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTExNTAwNjksImV4cCI6MjA2NjcyNjA2OX0.UFY3vSerY963T2cqbgrhstgZfhkgfN5KN7lZUVZ8DLA");class a{static async getCurrentUserProfile(){try{let{data:{user:e},error:t}=await s.auth.getUser();if(t||!e)return{data:null,error:Error("No authenticated user")};let{data:r,error:a}=await s.from("user_profiles").select("\n          *,\n          business_profiles (*)\n        ").eq("id",e.id).single();if(r&&r.business_profiles&&Array.isArray(r.business_profiles))return{data:{...r,business_profile:r.business_profiles[0]||null},error:null};return{data:r,error:a}}catch(e){return{data:null,error:e}}}static async getUserProfile(e){try{let{data:t,error:r}=await s.from("user_profiles").select("*").eq("id",e).single();return{data:t,error:r}}catch(e){return{data:null,error:e}}}static async updateUserProfile(e,t){try{let{data:r,error:a}=await s.from("user_profiles").update({...t,updated_at:new Date().toISOString()}).eq("id",e).select().single();return{data:r,error:a}}catch(e){return{data:null,error:e}}}static async upsertBusinessProfile(e,t){try{let{data:r,error:a}=await s.from("business_profiles").upsert({user_id:e,...t,updated_at:new Date().toISOString()}).select().single();return{data:r,error:a}}catch(e){return{data:null,error:e}}}static async updateFundabilityScore(e,t){try{let{data:r,error:a}=await s.from("user_profiles").update({fundability_score:t,last_assessment_date:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",e).select().single();return{data:r,error:a}}catch(e){return{data:null,error:e}}}static async incrementAssessmentCount(e){try{let{data:t,error:r}=await s.rpc("increment_assessment_count",{user_id:e});if(r){let{data:t}=await this.getUserProfile(e);if(t)return await this.updateUserProfile(e,{assessment_count:(t.assessment_count||0)+1})}return{data:t,error:r}}catch(e){return{data:null,error:e}}}}class n{static calculateAssessmentScore(e){try{let t=this.groupResponsesByCategory(e),r=[],s=0,a=0,n=0,o=e.length;for(let[e,o]of Object.entries(t)){let t=this.calculateCategoryScore(e,o);r.push(t),s+=t.weightedScore,a+=t.maxScore*t.weight,n+=t.completedCriteria}let c=a>0?s/a*100:0,i=o>0?n/o*100:0,l=this.generateRecommendations(r),u=this.identifyImprovementAreas(r),m=this.identifyStrengths(r);return{overallScore:Math.round(c),maxPossibleScore:Math.round(a),percentageScore:Math.round(100*c)/100,categoryScores:r,completedCriteria:n,totalCriteria:o,completionPercentage:Math.round(100*i)/100,recommendations:l,improvementAreas:u,strengths:m}}catch(e){throw console.error("Error calculating assessment score:",e),e}}static async saveAssessment(e,t){try{let r=t.categoryScores.reduce((e,t)=>(e[t.category]=t.score,e),{}),{data:a,error:n}=await s.from("advanced_fundability_assessments").insert({user_id:e,overall_score:t.overallScore,category_scores:r,completion_percentage:t.completionPercentage,recommendations:t.recommendations,improvement_areas:t.improvementAreas,strengths:t.strengths,status:"completed",assessment_version:"2.0"}).select().single();return!n&&a&&await this.saveScoreHistory(e,a.id,t),{data:a,error:n}}catch(e){return{data:null,error:e}}}static async saveScoreHistory(e,t,r){try{let{data:a}=await s.from("score_history").select("overall_score").eq("user_id",e).order("created_at",{ascending:!1}).limit(1).single(),n=a?r.overallScore-a.overall_score:0,o=r.categoryScores.reduce((e,t)=>(e[t.category]=t.score,e),{}),{data:c,error:i}=await s.from("score_history").insert({user_id:e,assessment_id:t,overall_score:r.overallScore,category_scores:o,assessment_date:new Date().toISOString().split("T")[0],score_change:n}).select().single();return{data:c,error:i}}catch(e){return{data:null,error:e}}}static groupResponsesByCategory(e){return e.reduce((e,t)=>{let r=t.category;return e[r]||(e[r]=[]),e[r].push(t),e},{})}static calculateCategoryScore(e,t){let r=0,s=0,a=0,n=t.length,o=this.CATEGORY_WEIGHTS[e]||1;t.forEach(e=>{let t=e.weightFactor||1;s+=e.pointsPossible*t,null!==e.responseValue&&void 0!==e.responseValue&&(a++,r+=e.pointsEarned*t)});let c=s>0?r/s*100:0,i=r*o;return{category:e,score:Math.round(r),maxScore:Math.round(s),percentage:Math.round(100*c)/100,weight:o,weightedScore:Math.round(i),completedCriteria:a,totalCriteria:n}}static generateRecommendations(e){let t=[];return e.filter(e=>e.percentage<80).sort((e,t)=>e.percentage-t.percentage).slice(0,5).forEach(e=>{t.push(this.getCategoryRecommendation(e.category,e.percentage))}),t}static identifyImprovementAreas(e){return e.filter(e=>e.percentage<70).sort((e,t)=>e.percentage-t.percentage).map(e=>e.category)}static identifyStrengths(e){return e.filter(e=>e.percentage>=85).sort((e,t)=>t.percentage-e.percentage).map(e=>e.category)}static getCategoryRecommendation(e,t){let r=t<50?"immediately":t<70?"soon":"when possible";return({"Business Foundation":"Strengthen your business foundation ".concat(r,". Focus on completing business registration and establishing core business infrastructure."),"Legal Structure":"Improve your legal structure ".concat(r,". Ensure all business licenses and legal documentation are current and complete."),"Banking & Finance":"Enhance your banking relationships ".concat(r,". Consider opening dedicated business accounts and establishing banking relationships."),"Business Credit Profile":"Build your business credit profile ".concat(r,". Apply for business credit accounts and monitor your business credit reports."),"Marketing Presence":"Develop your marketing presence ".concat(r,". Create professional online presence and marketing materials."),"Operational Excellence":"Improve operational systems ".concat(r,". Implement business processes and operational procedures."),Documentation:"Complete business documentation ".concat(r,". Organize and maintain all required business documents."),"Financial Health":"Strengthen financial health ".concat(r,". Focus on improving cash flow and financial management practices.")})[e]||"Improve ".concat(e.toLowerCase()," ").concat(r," to increase your fundability score.")}}n.CATEGORY_WEIGHTS={"Business Foundation":1.2,"Legal Structure":1.1,"Banking & Finance":1.3,"Business Credit Profile":1.4,"Marketing Presence":1,"Operational Excellence":1,Documentation:1.1,"Financial Health":1.2};class o{static async getAssessmentHistory(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let{limit:r=10,offset:a=0}=t,{data:n,error:o,count:c}=await s.from("advanced_fundability_assessments").select("*",{count:"exact"}).eq("user_id",e).order("created_at",{ascending:!1}).range(a,a+r-1);return{data:n,error:o,count:c||0}}catch(e){return{data:null,error:e}}}static async getLatestAssessment(e){try{let{data:t,error:r}=await s.from("advanced_fundability_assessments").select("*").eq("user_id",e).order("created_at",{ascending:!1}).limit(1).single();return{data:t,error:r}}catch(e){return{data:null,error:e}}}static async getScoreTrend(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30;try{let r=new Date;r.setDate(r.getDate()-t);let{data:a,error:n}=await s.from("score_history").select("*").eq("user_id",e).gte("assessment_date",r.toISOString().split("T")[0]).order("assessment_date",{ascending:!0});return{data:a,error:n}}catch(e){return{data:null,error:e}}}static async getAssessmentRecommendations(e){try{let{data:t,error:r}=await s.from("assessment_recommendations").select("*").eq("assessment_id",e).order("priority",{ascending:!1}).order("estimated_impact_points",{ascending:!1});return{data:t,error:r}}catch(e){return{data:null,error:e}}}static async detailedHealthCheck(){let e={connected:!1,tablesAccessible:[],errors:[]};for(let t of["users","user_profiles","advanced_fundability_assessments","score_history","business_profiles"])try{let{error:r}=await s.from(t).select("id").limit(1);r?e.errors.push("".concat(t,": ").concat(r.message)):e.tablesAccessible.push(t)}catch(r){e.errors.push("".concat(t,": ").concat(r))}return e.connected=e.tablesAccessible.length>0,e}}class c{async getLatestAssessment(e){try{console.log("Fetching assessment for user:",e);let t=new Promise((e,t)=>setTimeout(()=>t(Error("Query timeout")),1e4)),r=s.from("advanced_fundability_assessments").select("\n          *,\n          category_performances (*)\n        ").eq("user_id",e).order("created_at",{ascending:!1}).limit(1).single(),{data:a,error:n}=await Promise.race([r,t]);if(n||!a)return console.log("No assessment found or error:",null==n?void 0:n.message),this.getFallbackAssessment(e);return console.log("Assessment found:",a),a}catch(t){return console.error("Error fetching assessment:",t),this.getFallbackAssessment(e)}}async getAssessmentHistory(e){try{console.log("Fetching history for user:",e);let t=await this.getLatestAssessment(e);return t?[t]:[]}catch(e){return console.error("Error fetching history:",e),[]}}async getScoreHistory(e){try{return console.log("Fetching score history for user:",e),this.generateMockHistory(e)}catch(t){return console.error("Error fetching score history:",t),this.generateMockHistory(e)}}async saveAssessment(e,t,r,a){try{console.log("Saving assessment for user:",e);let{data:n,error:o}=await s.from("advanced_fundability_assessments").insert({user_id:e,overall_score:t,category_scores:r,completion_percentage:100,status:"completed",assessment_version:"2.0"}).select().single();if(o)return console.error("Error saving assessment:",o),null;if(a&&a.length>0){let e=a.map(e=>({assessment_id:n.id,category_name:e.categoryName,score:e.score,max_score:e.maxScore,completed_criteria:e.completedCriteria,total_criteria:e.totalCriteria})),{error:t}=await s.from("category_performances").insert(e);t&&console.error("Error saving category performances:",t)}let{error:c}=await s.from("score_history").insert({user_id:e,assessment_id:n.id,overall_score:t,category_scores:r,assessment_date:new Date().toDateString(),score_change:0});return c&&console.error("Error saving score history:",c),console.log("Assessment saved successfully:",n.id),n.id}catch(e){return console.error("Error in saveAssessment:",e),null}}getFallbackAssessment(e){let t={"admin@ybwfunds.com":95,"enterprise@ybwfunds.com":90,"business@ybwfunds.com":85,"demo@ybwfunds.com":75,"startup@ybwfunds.com":65,"lowscore@ybwfunds.com":25}[e]||82;return{id:"fallback-".concat(e),user_id:e,overall_score:t,category_scores:this.generateCategoryScores(t),created_at:new Date().toISOString(),completion_percentage:100,assessment_version:"2.0",status:"completed",category_performances:[{id:"1",category_name:"Business Registration",score:Math.max(30,t-10+20*Math.random()),max_score:100,completed_criteria:18,total_criteria:20},{id:"2",category_name:"Credit Profile",score:Math.max(30,t-5+15*Math.random()),max_score:100,completed_criteria:19,total_criteria:20},{id:"3",category_name:"Financial Documentation",score:Math.max(30,t+10*Math.random()),max_score:100,completed_criteria:17,total_criteria:20},{id:"4",category_name:"Operational Infrastructure",score:Math.max(30,t-15+25*Math.random()),max_score:100,completed_criteria:16,total_criteria:20},{id:"5",category_name:"Online Presence",score:Math.max(30,t-20+30*Math.random()),max_score:100,completed_criteria:15,total_criteria:20},{id:"6",category_name:"Risk & Compliance",score:Math.max(30,t-8+18*Math.random()),max_score:100,completed_criteria:19,total_criteria:20}]}}generateCategoryScores(e){let t={};return["business_registration","credit_profile","financial_documentation","operational_infrastructure","online_presence","risk_compliance"].forEach(r=>{t[r]=Math.max(0,Math.min(100,Math.round(e+(Math.random()-.5)*30)))}),t}generateMockHistory(e){let t=Math.max(20,({"admin@ybwfunds.com":95,"enterprise@ybwfunds.com":90,"business@ybwfunds.com":85,"demo@ybwfunds.com":75,"startup@ybwfunds.com":65,"lowscore@ybwfunds.com":25}[e]||82)-20);return["2024-01-01","2024-02-01","2024-03-01","2024-04-01","2024-05-01","2024-06-01"].map((e,r)=>({id:"history_".concat(r),overall_score:Math.round(t+4*r),assessment_date:e,category_scores:{}}))}transformToChartData(e){if(console.log("Transforming chart data:",e),!e||!e.category_performances)return{categoryData:[],overallScore:0,metrics:[]};let t=e.category_performances.map(e=>({category:e.category_name,score:Math.round(e.score),fullMark:e.max_score,benchmark:this.getIndustryBenchmark(e.category_name)})),r=e.category_performances.map(e=>({title:e.category_name,value:Math.round(e.score),change:Math.floor(20*Math.random())-10,color:this.getCategoryColor(e.category_name)}));return{categoryData:t,overallScore:e.overall_score,metrics:r}}transformToTrendData(e){return e.map((e,t)=>({date:new Date(e.assessment_date).toLocaleDateString("en-US",{month:"short",day:"numeric"}),score:e.overall_score}))}transformToComparisonData(e){return e&&e.category_performances?e.category_performances.map(e=>({category:e.category_name,score:Math.round(e.score),benchmark:this.getIndustryBenchmark(e.category_name),fullMark:e.max_score})):[]}getIndustryBenchmark(e){return({"Business Registration":75,"Credit Profile":80,"Financial Documentation":85,"Operational Infrastructure":78,"Online Presence":72,"Risk & Compliance":80})[e]||75}getCategoryColor(e){return({"Business Registration":"#10b981","Credit Profile":"#3b82f6","Financial Documentation":"#8b5cf6","Operational Infrastructure":"#f59e0b","Online Presence":"#ef4444","Risk & Compliance":"#06b6d4"})[e]||"#6b7280"}}let i=new c}}]);