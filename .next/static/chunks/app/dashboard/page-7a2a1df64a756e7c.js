(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{5745:function(e,s,t){Promise.resolve().then(t.bind(t,9171))},9171:function(e,s,t){"use strict";t.d(s,{DashboardOverview:function(){return u}});var r=t(7437),a=t(2265);let n=(0,t(6580).eI)("https://fzvtzzzsoccptvgihxfl.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ6dnR6enpzb2NjcHR2Z2loeGZsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTExNTAwNjksImV4cCI6MjA2NjcyNjA2OX0.UFY3vSerY963T2cqbgrhstgZfhkgfN5KN7lZUVZ8DLA");class o{static calculateAssessmentScore(e){try{let s=this.groupResponsesByCategory(e),t=[],r=0,a=0,n=0,o=e.length;for(let[e,o]of Object.entries(s)){let s=this.calculateCategoryScore(e,o);t.push(s),r+=s.weightedScore,a+=s.maxScore*s.weight,n+=s.completedCriteria}let c=a>0?r/a*100:0,i=o>0?n/o*100:0,l=this.generateRecommendations(t),d=this.identifyImprovementAreas(t),m=this.identifyStrengths(t);return{overallScore:Math.round(c),maxPossibleScore:Math.round(a),percentageScore:Math.round(100*c)/100,categoryScores:t,completedCriteria:n,totalCriteria:o,completionPercentage:Math.round(100*i)/100,recommendations:l,improvementAreas:d,strengths:m}}catch(e){throw console.error("Error calculating assessment score:",e),e}}static async saveAssessment(e,s){try{let t=s.categoryScores.reduce((e,s)=>(e[s.category]=s.score,e),{}),{data:r,error:a}=await n.from("advanced_fundability_assessments").insert({user_id:e,overall_score:s.overallScore,category_scores:t,completion_percentage:s.completionPercentage,recommendations:s.recommendations,improvement_areas:s.improvementAreas,strengths:s.strengths,status:"completed",assessment_version:"2.0"}).select().single();return!a&&r&&await this.saveScoreHistory(e,r.id,s),{data:r,error:a}}catch(e){return{data:null,error:e}}}static async saveScoreHistory(e,s,t){try{let{data:r}=await n.from("score_history").select("overall_score").eq("user_id",e).order("created_at",{ascending:!1}).limit(1).single(),a=r?t.overallScore-r.overall_score:0,o=t.categoryScores.reduce((e,s)=>(e[s.category]=s.score,e),{}),{data:c,error:i}=await n.from("score_history").insert({user_id:e,assessment_id:s,overall_score:t.overallScore,category_scores:o,assessment_date:new Date().toISOString().split("T")[0],score_change:a}).select().single();return{data:c,error:i}}catch(e){return{data:null,error:e}}}static groupResponsesByCategory(e){return e.reduce((e,s)=>{let t=s.category;return e[t]||(e[t]=[]),e[t].push(s),e},{})}static calculateCategoryScore(e,s){let t=0,r=0,a=0,n=s.length,o=this.CATEGORY_WEIGHTS[e]||1;s.forEach(e=>{let s=e.weightFactor||1;r+=e.pointsPossible*s,null!==e.responseValue&&void 0!==e.responseValue&&(a++,t+=e.pointsEarned*s)});let c=r>0?t/r*100:0,i=t*o;return{category:e,score:Math.round(t),maxScore:Math.round(r),percentage:Math.round(100*c)/100,weight:o,weightedScore:Math.round(i),completedCriteria:a,totalCriteria:n}}static generateRecommendations(e){let s=[];return e.filter(e=>e.percentage<80).sort((e,s)=>e.percentage-s.percentage).slice(0,5).forEach(e=>{s.push(this.getCategoryRecommendation(e.category,e.percentage))}),s}static identifyImprovementAreas(e){return e.filter(e=>e.percentage<70).sort((e,s)=>e.percentage-s.percentage).map(e=>e.category)}static identifyStrengths(e){return e.filter(e=>e.percentage>=85).sort((e,s)=>s.percentage-e.percentage).map(e=>e.category)}static getCategoryRecommendation(e,s){let t=s<50?"immediately":s<70?"soon":"when possible";return({"Business Foundation":"Strengthen your business foundation ".concat(t,". Focus on completing business registration and establishing core business infrastructure."),"Legal Structure":"Improve your legal structure ".concat(t,". Ensure all business licenses and legal documentation are current and complete."),"Banking & Finance":"Enhance your banking relationships ".concat(t,". Consider opening dedicated business accounts and establishing banking relationships."),"Business Credit Profile":"Build your business credit profile ".concat(t,". Apply for business credit accounts and monitor your business credit reports."),"Marketing Presence":"Develop your marketing presence ".concat(t,". Create professional online presence and marketing materials."),"Operational Excellence":"Improve operational systems ".concat(t,". Implement business processes and operational procedures."),Documentation:"Complete business documentation ".concat(t,". Organize and maintain all required business documents."),"Financial Health":"Strengthen financial health ".concat(t,". Focus on improving cash flow and financial management practices.")})[e]||"Improve ".concat(e.toLowerCase()," ").concat(t," to increase your fundability score.")}}o.CATEGORY_WEIGHTS={"Business Foundation":1.2,"Legal Structure":1.1,"Banking & Finance":1.3,"Business Credit Profile":1.4,"Marketing Presence":1,"Operational Excellence":1,Documentation:1.1,"Financial Health":1.2};class c{static async getAssessmentHistory(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let{limit:t=10,offset:r=0}=s,{data:a,error:o,count:c}=await n.from("advanced_fundability_assessments").select("*",{count:"exact"}).eq("user_id",e).order("created_at",{ascending:!1}).range(r,r+t-1);return{data:a,error:o,count:c||0}}catch(e){return{data:null,error:e}}}static async getLatestAssessment(e){try{let{data:s,error:t}=await n.from("advanced_fundability_assessments").select("*").eq("user_id",e).order("created_at",{ascending:!1}).limit(1).single();return{data:s,error:t}}catch(e){return{data:null,error:e}}}static async getScoreTrend(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30;try{let t=new Date;t.setDate(t.getDate()-s);let{data:r,error:a}=await n.from("score_history").select("*").eq("user_id",e).gte("assessment_date",t.toISOString().split("T")[0]).order("assessment_date",{ascending:!0});return{data:r,error:a}}catch(e){return{data:null,error:e}}}static async getAssessmentRecommendations(e){try{let{data:s,error:t}=await n.from("assessment_recommendations").select("*").eq("assessment_id",e).order("priority",{ascending:!1}).order("estimated_impact_points",{ascending:!1});return{data:s,error:t}}catch(e){return{data:null,error:e}}}static async detailedHealthCheck(){let e={connected:!1,tablesAccessible:[],errors:[]};for(let s of["users","user_profiles","advanced_fundability_assessments","score_history","business_profiles"])try{let{error:t}=await n.from(s).select("id").limit(1);t?e.errors.push("".concat(s,": ").concat(t.message)):e.tablesAccessible.push(s)}catch(t){e.errors.push("".concat(s,": ").concat(t))}return e.connected=e.tablesAccessible.length>0,e}}class i{async getLatestAssessment(e){try{console.log("Fetching assessment for user:",e);let s=new Promise((e,s)=>setTimeout(()=>s(Error("Query timeout")),1e4)),t=n.from("advanced_fundability_assessments").select("\n          *,\n          category_performances (*)\n        ").eq("user_id",e).order("created_at",{ascending:!1}).limit(1).single(),{data:r,error:a}=await Promise.race([t,s]);if(a||!r)return console.log("No assessment found or error:",null==a?void 0:a.message),this.getFallbackAssessment(e);return console.log("Assessment found:",r),r}catch(s){return console.error("Error fetching assessment:",s),this.getFallbackAssessment(e)}}async getAssessmentHistory(e){try{console.log("Fetching history for user:",e);let s=await this.getLatestAssessment(e);return s?[s]:[]}catch(e){return console.error("Error fetching history:",e),[]}}async getScoreHistory(e){try{return console.log("Fetching score history for user:",e),this.generateMockHistory(e)}catch(s){return console.error("Error fetching score history:",s),this.generateMockHistory(e)}}async saveAssessment(e,s,t,r){try{console.log("Saving assessment for user:",e);let{data:a,error:o}=await n.from("advanced_fundability_assessments").insert({user_id:e,overall_score:s,category_scores:t,completion_percentage:100,status:"completed",assessment_version:"2.0"}).select().single();if(o)return console.error("Error saving assessment:",o),null;if(r&&r.length>0){let e=r.map(e=>({assessment_id:a.id,category_name:e.categoryName,score:e.score,max_score:e.maxScore,completed_criteria:e.completedCriteria,total_criteria:e.totalCriteria})),{error:s}=await n.from("category_performances").insert(e);s&&console.error("Error saving category performances:",s)}let{error:c}=await n.from("score_history").insert({user_id:e,assessment_id:a.id,overall_score:s,category_scores:t,assessment_date:new Date().toDateString(),score_change:0});return c&&console.error("Error saving score history:",c),console.log("Assessment saved successfully:",a.id),a.id}catch(e){return console.error("Error in saveAssessment:",e),null}}getFallbackAssessment(e){let s={"admin@ybwfunds.com":95,"enterprise@ybwfunds.com":90,"business@ybwfunds.com":85,"demo@ybwfunds.com":75,"startup@ybwfunds.com":65,"lowscore@ybwfunds.com":25}[e]||82;return{id:"fallback-".concat(e),user_id:e,overall_score:s,category_scores:this.generateCategoryScores(s),created_at:new Date().toISOString(),completion_percentage:100,assessment_version:"2.0",status:"completed",category_performances:[{id:"1",category_name:"Business Registration",score:Math.max(30,s-10+20*Math.random()),max_score:100,completed_criteria:18,total_criteria:20},{id:"2",category_name:"Credit Profile",score:Math.max(30,s-5+15*Math.random()),max_score:100,completed_criteria:19,total_criteria:20},{id:"3",category_name:"Financial Documentation",score:Math.max(30,s+10*Math.random()),max_score:100,completed_criteria:17,total_criteria:20},{id:"4",category_name:"Operational Infrastructure",score:Math.max(30,s-15+25*Math.random()),max_score:100,completed_criteria:16,total_criteria:20},{id:"5",category_name:"Online Presence",score:Math.max(30,s-20+30*Math.random()),max_score:100,completed_criteria:15,total_criteria:20},{id:"6",category_name:"Risk & Compliance",score:Math.max(30,s-8+18*Math.random()),max_score:100,completed_criteria:19,total_criteria:20}]}}generateCategoryScores(e){let s={};return["business_registration","credit_profile","financial_documentation","operational_infrastructure","online_presence","risk_compliance"].forEach(t=>{s[t]=Math.max(0,Math.min(100,Math.round(e+(Math.random()-.5)*30)))}),s}generateMockHistory(e){let s=Math.max(20,({"admin@ybwfunds.com":95,"enterprise@ybwfunds.com":90,"business@ybwfunds.com":85,"demo@ybwfunds.com":75,"startup@ybwfunds.com":65,"lowscore@ybwfunds.com":25}[e]||82)-20);return["2024-01-01","2024-02-01","2024-03-01","2024-04-01","2024-05-01","2024-06-01"].map((e,t)=>({id:"history_".concat(t),overall_score:Math.round(s+4*t),assessment_date:e,category_scores:{}}))}transformToChartData(e){if(console.log("Transforming chart data:",e),!e||!e.category_performances)return{categoryData:[],overallScore:0,metrics:[]};let s=e.category_performances.map(e=>({category:e.category_name,score:Math.round(e.score),fullMark:e.max_score,benchmark:this.getIndustryBenchmark(e.category_name)})),t=e.category_performances.map(e=>({title:e.category_name,value:Math.round(e.score),change:Math.floor(20*Math.random())-10,color:this.getCategoryColor(e.category_name)}));return{categoryData:s,overallScore:e.overall_score,metrics:t}}transformToTrendData(e){return e.map((e,s)=>({date:new Date(e.assessment_date).toLocaleDateString("en-US",{month:"short",day:"numeric"}),score:e.overall_score}))}transformToComparisonData(e){return e&&e.category_performances?e.category_performances.map(e=>({category:e.category_name,score:Math.round(e.score),benchmark:this.getIndustryBenchmark(e.category_name),fullMark:e.max_score})):[]}getIndustryBenchmark(e){return({"Business Registration":75,"Credit Profile":80,"Financial Documentation":85,"Operational Infrastructure":78,"Online Presence":72,"Risk & Compliance":80})[e]||75}getCategoryColor(e){return({"Business Registration":"#10b981","Credit Profile":"#3b82f6","Financial Documentation":"#8b5cf6","Operational Infrastructure":"#f59e0b","Online Presence":"#ef4444","Risk & Compliance":"#06b6d4"})[e]||"#6b7280"}}function l(e){let{score:s,maxScore:t=100,size:a=200}=e,n=Math.min(s/t*100,100),o=2*Math.PI*45;return(0,r.jsx)("div",{className:"flex items-center justify-center",children:(0,r.jsxs)("div",{className:"relative",style:{width:a,height:a},children:[(0,r.jsxs)("svg",{className:"transform -rotate-90",width:a,height:a,viewBox:"0 0 100 100",children:[(0,r.jsx)("circle",{cx:"50",cy:"50",r:"45",stroke:"#e5e7eb",strokeWidth:"8",fill:"transparent"}),(0,r.jsx)("circle",{cx:"50",cy:"50",r:"45",stroke:s>=80?"#10b981":s>=60?"#f59e0b":s>=40?"#f97316":"#ef4444",strokeWidth:"8",fill:"transparent",strokeDasharray:o,strokeDashoffset:o-n/100*o,strokeLinecap:"round",className:"transition-all duration-1000 ease-in-out"})]}),(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"text-3xl font-bold text-gray-900",children:s}),(0,r.jsxs)("div",{className:"text-sm text-gray-600",children:["/ ",t]})]})})]})})}function d(e){let{assessments:s,loading:t}=e;return t?(0,r.jsx)("div",{className:"animate-pulse space-y-3",children:[1,2,3].map(e=>(0,r.jsx)("div",{className:"h-4 bg-gray-200 rounded"},e))}):s&&0!==s.length?(0,r.jsxs)("div",{className:"space-y-4",children:[s.slice(0,5).map((e,t)=>(0,r.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("p",{className:"font-medium",children:["Assessment #",s.length-t]}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:new Date(e.created_at).toLocaleDateString()})]}),(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsx)("p",{className:"text-lg font-bold text-blue-600",children:e.overall_score}),(0,r.jsx)("p",{className:"text-xs text-gray-500",children:"Score"})]})]},e.id)),s.length>5&&(0,r.jsxs)("button",{className:"w-full text-blue-600 text-sm hover:text-blue-800",children:["View all ",s.length," assessments"]})]}):(0,r.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,r.jsx)("p",{children:"No assessment history yet"}),(0,r.jsx)("p",{className:"text-sm mt-2",children:"Take your first assessment to see your progress here"})]})}function m(e){let{title:s,value:t,change:a,icon:n}=e;return(0,r.jsx)("div",{className:"bg-white p-6 rounded-lg shadow",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-600",children:s}),(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:t}),void 0!==a&&(0,r.jsxs)("p",{className:"text-sm ".concat(a>=0?"text-green-600":"text-red-600"),children:[a>=0?"+":"",a]})]}),n&&(0,r.jsx)("div",{className:"text-2xl",children:n})]})})}function u(){let{userProfile:e,latestAssessment:s,stats:t,loading:n,error:o,refresh:i}=function(){let[e,s]=(0,a.useState)({userProfile:null,latestAssessment:null,assessmentHistory:[],scoreTrend:[],loading:!0,error:null,stats:{totalAssessments:0,currentScore:0,scoreChange:0,lastAssessmentDate:null}});(0,a.useEffect)(()=>{t()},[]),(0,a.useEffect)(()=>{let e=()=>{console.log("\uD83D\uDD04 Dashboard refresh triggered, reloading data..."),setTimeout(()=>{t()},500)};return window.addEventListener("dashboardRefresh",e),()=>{window.removeEventListener("dashboardRefresh",e)}},[]),(0,a.useEffect)(()=>{let e=()=>{let e=localStorage.getItem("lastAssessmentResults");if(e)try{let s=JSON.parse(e),r=new Date(s.completedAt);(new Date().getTime()-r.getTime())/6e4<5&&(console.log("\uD83C\uDD95 Recent assessment detected, refreshing dashboard..."),t())}catch(e){console.error("Error parsing recent assessment results:",e)}};return e(),window.addEventListener("storage",e),()=>{window.removeEventListener("storage",e)}},[]);let t=async()=>{try{var e;console.log("\uD83D\uDCCA Loading dashboard data..."),s(e=>({...e,loading:!0,error:null}));let t=null,r=null,a=localStorage.getItem("demoUserId");if(a){console.log("\uD83D\uDD0D Loading data for user:",a);try{let{data:e}=await c.getLatestAssessment(a);e&&(console.log("✅ Got real assessment from database:",e),r=e);let s=await fetch("/api/user/profile?userId="+a);if(s.ok){let e=await s.json();e.success&&(t=e.data,console.log("✅ Got real user profile from database"))}}catch(e){console.warn("Database query failed, using localStorage:",e)}}if(!t||!r){let e=localStorage.getItem("lastAssessmentResults");if(e)try{let s=JSON.parse(e);console.log("\uD83D\uDCF1 Using localStorage data as fallback"),t=t||{id:a||"demo-user",email:"demo@ybwfunds.com",name:"Demo User",business_name:"Demo Business",fundability_score:s.currentScore,assessment_count:1,last_assessment_date:s.completedAt,created_at:new Date().toISOString(),updated_at:s.completedAt},r=r||{id:"local-assessment",user_id:t.id,overall_score:s.currentScore,category_scores:s.categoryScores,completion_percentage:100,status:"completed",assessment_version:"2.0",created_at:s.completedAt,updated_at:s.completedAt}}catch(e){console.error("Error parsing localStorage data:",e)}}let n=(null==r?void 0:r.overall_score)||0,o=(null==r?void 0:r.created_at)||null;console.log("\uD83D\uDCC8 Final dashboard data loaded:",{currentScore:n,lastAssessmentDate:o,source:(null==r?void 0:null===(e=r.id)||void 0===e?void 0:e.includes("local"))?"localStorage":"database"}),s({userProfile:t,latestAssessment:r,assessmentHistory:r?[r]:[],scoreTrend:[],loading:!1,error:null,stats:{totalAssessments:1,currentScore:n,scoreChange:0,lastAssessmentDate:o}})}catch(e){console.error("❌ Error loading dashboard data:",e),s(e=>({...e,loading:!1,error:"Unable to load dashboard data"}))}};return{...e,refresh:()=>{console.log("\uD83D\uDD04 Manual refresh triggered"),t()}}}();return n?(0,r.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):o?(0,r.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[(0,r.jsx)("h3",{className:"text-red-800 font-semibold",children:"Error Loading Dashboard"}),(0,r.jsx)("p",{className:"text-red-600 mt-2",children:o}),(0,r.jsx)("button",{onClick:i,className:"mt-4 bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700",children:"Try Again"})]}):(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"bg-gradient-to-r from-blue-600 to-blue-800 text-white p-6 rounded-lg",children:[(0,r.jsxs)("h1",{className:"text-2xl font-bold",children:["Welcome back, ",(null==e?void 0:e.name)||"User","!"]}),(0,r.jsx)("p",{className:"mt-2 opacity-90",children:(null==e?void 0:e.business_name)?"Managing ".concat(e.business_name):"Track your business fundability progress"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,r.jsx)(m,{title:"Current Score",value:t.currentScore,change:t.scoreChange,icon:"\uD83D\uDCCA"}),(0,r.jsx)(m,{title:"Total Assessments",value:t.totalAssessments,icon:"\uD83D\uDCCB"}),(0,r.jsx)(m,{title:"Last Assessment",value:t.lastAssessmentDate?new Date(t.lastAssessmentDate).toLocaleDateString():"Never",icon:"\uD83D\uDCC5"}),(0,r.jsx)(m,{title:"Fundability Grade",value:g(t.currentScore),icon:"\uD83C\uDF93"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Fundability Score"}),(0,r.jsx)(l,{score:t.currentScore,size:200}),(0,r.jsxs)("div",{className:"mt-4 text-center",children:[(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:t.currentScore}),(0,r.jsxs)("p",{className:"text-gray-600",children:["Grade: ",g(t.currentScore)]})]})]}),(0,r.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Assessment History"}),(0,r.jsx)(d,{assessments:[],loading:n})]})]}),(0,r.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Recent Activity"}),(0,r.jsxs)("div",{className:"text-gray-500 text-center py-8",children:[(0,r.jsx)("p",{children:"Activity tracking coming soon..."}),(0,r.jsx)("p",{className:"text-sm mt-2",children:"We'll show your recent assessments, score changes, and recommendations here."})]})]}),(0,r.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Quick Actions"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,r.jsx)("button",{onClick:()=>window.location.href="/assessment",className:"bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors font-medium",children:"Take New Assessment"}),(0,r.jsx)("button",{className:"bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-colors font-medium",children:"View Recommendations"}),(0,r.jsx)("button",{onClick:()=>window.print(),className:"bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 transition-colors font-medium",children:"Download Report"})]})]})]})}function g(e){return e>=90?"A - Excellent":e>=80?"B - Good":e>=70?"C - Fair":e>=60?"D - Poor":"F - Very Poor"}new i}},function(e){e.O(0,[580,971,117,744],function(){return e(e.s=5745)}),_N_E=e.O()}]);