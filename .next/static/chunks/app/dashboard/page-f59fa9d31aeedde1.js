(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{75745:function(e,s,t){Promise.resolve().then(t.bind(t,15811))},15811:function(e,s,t){"use strict";t.d(s,{DashboardOverview:function(){return E}});var r=t(57437),a=t(2265);let n=(0,t(96580).eI)("https://fzvtzzzsoccptvgihxfl.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ6dnR6enpzb2NjcHR2Z2loeGZsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTExNTAwNjksImV4cCI6MjA2NjcyNjA2OX0.UFY3vSerY963T2cqbgrhstgZfhkgfN5KN7lZUVZ8DLA");class o{static calculateAssessmentScore(e){try{let s=this.groupResponsesByCategory(e),t=[],r=0,a=0,n=0,o=e.length;for(let[e,o]of Object.entries(s)){let s=this.calculateCategoryScore(e,o);t.push(s),r+=s.weightedScore,a+=s.maxScore*s.weight,n+=s.completedCriteria}let i=a>0?r/a*100:0,c=o>0?n/o*100:0,l=this.generateRecommendations(t),d=this.identifyImprovementAreas(t),m=this.identifyStrengths(t);return{overallScore:Math.round(i),maxPossibleScore:Math.round(a),percentageScore:Math.round(100*i)/100,categoryScores:t,completedCriteria:n,totalCriteria:o,completionPercentage:Math.round(100*c)/100,recommendations:l,improvementAreas:d,strengths:m}}catch(e){throw console.error("Error calculating assessment score:",e),e}}static async saveAssessment(e,s){try{let t=s.categoryScores.reduce((e,s)=>(e[s.category]=s.score,e),{}),{data:r,error:a}=await n.from("advanced_fundability_assessments").insert({user_id:e,overall_score:s.overallScore,category_scores:t,completion_percentage:s.completionPercentage,recommendations:s.recommendations,improvement_areas:s.improvementAreas,strengths:s.strengths,status:"completed",assessment_version:"2.0"}).select().single();return!a&&r&&await this.saveScoreHistory(e,r.id,s),{data:r,error:a}}catch(e){return{data:null,error:e}}}static async saveScoreHistory(e,s,t){try{let{data:r}=await n.from("score_history").select("overall_score").eq("user_id",e).order("created_at",{ascending:!1}).limit(1).single(),a=r?t.overallScore-r.overall_score:0,o=t.categoryScores.reduce((e,s)=>(e[s.category]=s.score,e),{}),{data:i,error:c}=await n.from("score_history").insert({user_id:e,assessment_id:s,overall_score:t.overallScore,category_scores:o,assessment_date:new Date().toISOString().split("T")[0],score_change:a}).select().single();return{data:i,error:c}}catch(e){return{data:null,error:e}}}static groupResponsesByCategory(e){return e.reduce((e,s)=>{let t=s.category;return e[t]||(e[t]=[]),e[t].push(s),e},{})}static calculateCategoryScore(e,s){let t=0,r=0,a=0,n=s.length,o=this.CATEGORY_WEIGHTS[e]||1;s.forEach(e=>{let s=e.weightFactor||1;r+=e.pointsPossible*s,null!==e.responseValue&&void 0!==e.responseValue&&(a++,t+=e.pointsEarned*s)});let i=r>0?t/r*100:0,c=t*o;return{category:e,score:Math.round(t),maxScore:Math.round(r),percentage:Math.round(100*i)/100,weight:o,weightedScore:Math.round(c),completedCriteria:a,totalCriteria:n}}static generateRecommendations(e){let s=[];return e.filter(e=>e.percentage<80).sort((e,s)=>e.percentage-s.percentage).slice(0,5).forEach(e=>{s.push(this.getCategoryRecommendation(e.category,e.percentage))}),s}static identifyImprovementAreas(e){return e.filter(e=>e.percentage<70).sort((e,s)=>e.percentage-s.percentage).map(e=>e.category)}static identifyStrengths(e){return e.filter(e=>e.percentage>=85).sort((e,s)=>s.percentage-e.percentage).map(e=>e.category)}static getCategoryRecommendation(e,s){let t=s<50?"immediately":s<70?"soon":"when possible";return({"Business Foundation":"Strengthen your business foundation ".concat(t,". Focus on completing business registration and establishing core business infrastructure."),"Legal Structure":"Improve your legal structure ".concat(t,". Ensure all business licenses and legal documentation are current and complete."),"Banking & Finance":"Enhance your banking relationships ".concat(t,". Consider opening dedicated business accounts and establishing banking relationships."),"Business Credit Profile":"Build your business credit profile ".concat(t,". Apply for business credit accounts and monitor your business credit reports."),"Marketing Presence":"Develop your marketing presence ".concat(t,". Create professional online presence and marketing materials."),"Operational Excellence":"Improve operational systems ".concat(t,". Implement business processes and operational procedures."),Documentation:"Complete business documentation ".concat(t,". Organize and maintain all required business documents."),"Financial Health":"Strengthen financial health ".concat(t,". Focus on improving cash flow and financial management practices.")})[e]||"Improve ".concat(e.toLowerCase()," ").concat(t," to increase your fundability score.")}}o.CATEGORY_WEIGHTS={"Business Foundation":1.2,"Legal Structure":1.1,"Banking & Finance":1.3,"Business Credit Profile":1.4,"Marketing Presence":1,"Operational Excellence":1,Documentation:1.1,"Financial Health":1.2};class i{static async getAssessmentHistory(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let{limit:t=10,offset:r=0}=s,{data:a,error:o,count:i}=await n.from("advanced_fundability_assessments").select("*",{count:"exact"}).eq("user_id",e).order("created_at",{ascending:!1}).range(r,r+t-1);return{data:a,error:o,count:i||0}}catch(e){return{data:null,error:e}}}static async getLatestAssessment(e){try{let{data:s,error:t}=await n.from("advanced_fundability_assessments").select("*").eq("user_id",e).order("created_at",{ascending:!1}).limit(1).single();return{data:s,error:t}}catch(e){return{data:null,error:e}}}static async getScoreTrend(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30;try{let t=new Date;t.setDate(t.getDate()-s);let{data:r,error:a}=await n.from("score_history").select("*").eq("user_id",e).gte("assessment_date",t.toISOString().split("T")[0]).order("assessment_date",{ascending:!0});return{data:r,error:a}}catch(e){return{data:null,error:e}}}static async getAssessmentRecommendations(e){try{let{data:s,error:t}=await n.from("assessment_recommendations").select("*").eq("assessment_id",e).order("priority",{ascending:!1}).order("estimated_impact_points",{ascending:!1});return{data:s,error:t}}catch(e){return{data:null,error:e}}}static async detailedHealthCheck(){let e={connected:!1,tablesAccessible:[],errors:[]};for(let s of["users","user_profiles","advanced_fundability_assessments","score_history","business_profiles"])try{let{error:t}=await n.from(s).select("id").limit(1);t?e.errors.push("".concat(s,": ").concat(t.message)):e.tablesAccessible.push(s)}catch(t){e.errors.push("".concat(s,": ").concat(t))}return e.connected=e.tablesAccessible.length>0,e}}class c{async getLatestAssessment(e){try{console.log("Fetching assessment for user:",e);let s=new Promise((e,s)=>setTimeout(()=>s(Error("Query timeout")),1e4)),t=n.from("advanced_fundability_assessments").select("\n          *,\n          category_performances (*)\n        ").eq("user_id",e).order("created_at",{ascending:!1}).limit(1).single(),{data:r,error:a}=await Promise.race([t,s]);if(a||!r)return console.log("No assessment found or error:",null==a?void 0:a.message),this.getFallbackAssessment(e);return console.log("Assessment found:",r),r}catch(s){return console.error("Error fetching assessment:",s),this.getFallbackAssessment(e)}}async getAssessmentHistory(e){try{console.log("Fetching history for user:",e);let s=await this.getLatestAssessment(e);return s?[s]:[]}catch(e){return console.error("Error fetching history:",e),[]}}async getScoreHistory(e){try{return console.log("Fetching score history for user:",e),this.generateMockHistory(e)}catch(s){return console.error("Error fetching score history:",s),this.generateMockHistory(e)}}async saveAssessment(e,s,t,r){try{console.log("Saving assessment for user:",e);let{data:a,error:o}=await n.from("advanced_fundability_assessments").insert({user_id:e,overall_score:s,category_scores:t,completion_percentage:100,status:"completed",assessment_version:"2.0"}).select().single();if(o)return console.error("Error saving assessment:",o),null;if(r&&r.length>0){let e=r.map(e=>({assessment_id:a.id,category_name:e.categoryName,score:e.score,max_score:e.maxScore,completed_criteria:e.completedCriteria,total_criteria:e.totalCriteria})),{error:s}=await n.from("category_performances").insert(e);s&&console.error("Error saving category performances:",s)}let{error:i}=await n.from("score_history").insert({user_id:e,assessment_id:a.id,overall_score:s,category_scores:t,assessment_date:new Date().toDateString(),score_change:0});return i&&console.error("Error saving score history:",i),console.log("Assessment saved successfully:",a.id),a.id}catch(e){return console.error("Error in saveAssessment:",e),null}}getFallbackAssessment(e){let s={"admin@ybwfunds.com":95,"enterprise@ybwfunds.com":90,"business@ybwfunds.com":85,"demo@ybwfunds.com":75,"startup@ybwfunds.com":65,"lowscore@ybwfunds.com":25}[e]||82;return{id:"fallback-".concat(e),user_id:e,overall_score:s,category_scores:this.generateCategoryScores(s),created_at:new Date().toISOString(),completion_percentage:100,assessment_version:"2.0",status:"completed",category_performances:[{id:"1",category_name:"Business Registration",score:Math.max(30,s-10+20*Math.random()),max_score:100,completed_criteria:18,total_criteria:20},{id:"2",category_name:"Credit Profile",score:Math.max(30,s-5+15*Math.random()),max_score:100,completed_criteria:19,total_criteria:20},{id:"3",category_name:"Financial Documentation",score:Math.max(30,s+10*Math.random()),max_score:100,completed_criteria:17,total_criteria:20},{id:"4",category_name:"Operational Infrastructure",score:Math.max(30,s-15+25*Math.random()),max_score:100,completed_criteria:16,total_criteria:20},{id:"5",category_name:"Online Presence",score:Math.max(30,s-20+30*Math.random()),max_score:100,completed_criteria:15,total_criteria:20},{id:"6",category_name:"Risk & Compliance",score:Math.max(30,s-8+18*Math.random()),max_score:100,completed_criteria:19,total_criteria:20}]}}generateCategoryScores(e){let s={};return["business_registration","credit_profile","financial_documentation","operational_infrastructure","online_presence","risk_compliance"].forEach(t=>{s[t]=Math.max(0,Math.min(100,Math.round(e+(Math.random()-.5)*30)))}),s}generateMockHistory(e){let s=Math.max(20,({"admin@ybwfunds.com":95,"enterprise@ybwfunds.com":90,"business@ybwfunds.com":85,"demo@ybwfunds.com":75,"startup@ybwfunds.com":65,"lowscore@ybwfunds.com":25}[e]||82)-20);return["2024-01-01","2024-02-01","2024-03-01","2024-04-01","2024-05-01","2024-06-01"].map((e,t)=>({id:"history_".concat(t),overall_score:Math.round(s+4*t),assessment_date:e,category_scores:{}}))}transformToChartData(e){if(console.log("Transforming chart data:",e),!e||!e.category_performances)return{categoryData:[],overallScore:0,metrics:[]};let s=e.category_performances.map(e=>({category:e.category_name,score:Math.round(e.score),fullMark:e.max_score,benchmark:this.getIndustryBenchmark(e.category_name)})),t=e.category_performances.map(e=>({title:e.category_name,value:Math.round(e.score),change:Math.floor(20*Math.random())-10,color:this.getCategoryColor(e.category_name)}));return{categoryData:s,overallScore:e.overall_score,metrics:t}}transformToTrendData(e){return e.map((e,s)=>({date:new Date(e.assessment_date).toLocaleDateString("en-US",{month:"short",day:"numeric"}),score:e.overall_score}))}transformToComparisonData(e){return e&&e.category_performances?e.category_performances.map(e=>({category:e.category_name,score:Math.round(e.score),benchmark:this.getIndustryBenchmark(e.category_name),fullMark:e.max_score})):[]}getIndustryBenchmark(e){return({"Business Registration":75,"Credit Profile":80,"Financial Documentation":85,"Operational Infrastructure":78,"Online Presence":72,"Risk & Compliance":80})[e]||75}getCategoryColor(e){return({"Business Registration":"#10b981","Credit Profile":"#3b82f6","Financial Documentation":"#8b5cf6","Operational Infrastructure":"#f59e0b","Online Presence":"#ef4444","Risk & Compliance":"#06b6d4"})[e]||"#6b7280"}}function l(e){let{score:s,maxScore:t=100,size:a=200}=e,n=Math.min(s/t*100,100),o=2*Math.PI*45;return(0,r.jsx)("div",{className:"flex items-center justify-center",children:(0,r.jsxs)("div",{className:"relative",style:{width:a,height:a},children:[(0,r.jsxs)("svg",{className:"transform -rotate-90",width:a,height:a,viewBox:"0 0 100 100",children:[(0,r.jsx)("circle",{cx:"50",cy:"50",r:"45",stroke:"#e5e7eb",strokeWidth:"8",fill:"transparent"}),(0,r.jsx)("circle",{cx:"50",cy:"50",r:"45",stroke:s>=80?"#10b981":s>=60?"#f59e0b":s>=40?"#f97316":"#ef4444",strokeWidth:"8",fill:"transparent",strokeDasharray:o,strokeDashoffset:o-n/100*o,strokeLinecap:"round",className:"transition-all duration-1000 ease-in-out"})]}),(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"text-3xl font-bold text-gray-900",children:s}),(0,r.jsxs)("div",{className:"text-sm text-gray-600",children:["/ ",t]})]})})]})})}function d(e){let{title:s,value:t,change:a,icon:n}=e;return(0,r.jsx)("div",{className:"bg-white p-6 rounded-lg shadow",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-600",children:s}),(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:t}),void 0!==a&&(0,r.jsxs)("p",{className:"text-sm ".concat(a>=0?"text-green-600":"text-red-600"),children:[a>=0?"+":"",a]})]}),n&&(0,r.jsx)("div",{className:"text-2xl",children:n})]})})}new c;var m=t(47625),u=t(5481),g=t(56940),h=t(97059),p=t(62994),x=t(8147),y=t(23263);function f(e){var s;let{data:t,loading:n}=e,o=a.useMemo(()=>{let e=new Date;return[{date:new Date(e.getTime()-7776e6).toLocaleDateString(),score:45,assessmentType:"Initial"},{date:new Date(e.getTime()-5184e6).toLocaleDateString(),score:52,assessmentType:"Follow-up"},{date:new Date(e.getTime()-2592e6).toLocaleDateString(),score:58,assessmentType:"Progress"},{date:e.toLocaleDateString(),score:t.length>0?t[t.length-1].score:60,assessmentType:"Current"}]},[t]),i=t.length>0?t:o;return n?(0,r.jsx)("div",{className:"bg-white p-6 rounded-lg shadow",children:(0,r.jsxs)("div",{className:"animate-pulse",children:[(0,r.jsx)("div",{className:"h-4 bg-gray-200 rounded w-1/4 mb-4"}),(0,r.jsx)("div",{className:"h-48 bg-gray-200 rounded"})]})}):(0,r.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Score Trend"}),(0,r.jsx)("div",{className:"flex items-center space-x-4",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"w-3 h-3 bg-blue-500 rounded-full mr-2"}),(0,r.jsx)("span",{className:"text-sm text-gray-600",children:"Fundability Score"})]})})]}),(0,r.jsx)("div",{className:"h-64",children:(0,r.jsx)(m.h,{width:"100%",height:"100%",children:(0,r.jsxs)(u.T,{data:i,children:[(0,r.jsx)("defs",{children:(0,r.jsxs)("linearGradient",{id:"scoreGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,r.jsx)("stop",{offset:"5%",stopColor:"#3B82F6",stopOpacity:.3}),(0,r.jsx)("stop",{offset:"95%",stopColor:"#3B82F6",stopOpacity:0})]})}),(0,r.jsx)(g.q,{strokeDasharray:"3 3",stroke:"#E5E7EB"}),(0,r.jsx)(h.K,{dataKey:"date",stroke:"#6B7280",fontSize:12}),(0,r.jsx)(p.B,{domain:[0,100],stroke:"#6B7280",fontSize:12}),(0,r.jsx)(x.u,{contentStyle:{backgroundColor:"#F9FAFB",border:"1px solid #E5E7EB",borderRadius:"8px",fontSize:"14px"},formatter:(e,s)=>["".concat(e," points"),"Fundability Score"],labelFormatter:e=>"Date: ".concat(e)}),(0,r.jsx)(y.u,{type:"monotone",dataKey:"score",stroke:"#3B82F6",strokeWidth:3,fill:"url(#scoreGradient)",dot:{fill:"#3B82F6",strokeWidth:2,r:5},activeDot:{r:7,stroke:"#3B82F6",strokeWidth:2}})]})})}),(0,r.jsxs)("div",{className:"mt-4 grid grid-cols-3 gap-4 text-center",children:[(0,r.jsxs)("div",{className:"p-3 bg-green-50 rounded-lg",children:[(0,r.jsx)("p",{className:"text-sm text-green-600 font-medium",children:"Best Score"}),(0,r.jsx)("p",{className:"text-lg font-bold text-green-800",children:Math.max(...i.map(e=>e.score))})]}),(0,r.jsxs)("div",{className:"p-3 bg-blue-50 rounded-lg",children:[(0,r.jsx)("p",{className:"text-sm text-blue-600 font-medium",children:"Current"}),(0,r.jsx)("p",{className:"text-lg font-bold text-blue-800",children:(null===(s=i[i.length-1])||void 0===s?void 0:s.score)||0})]}),(0,r.jsxs)("div",{className:"p-3 bg-purple-50 rounded-lg",children:[(0,r.jsx)("p",{className:"text-sm text-purple-600 font-medium",children:"Improvement"}),(0,r.jsxs)("p",{className:"text-lg font-bold text-purple-800",children:["+",i.length>1?i[i.length-1].score-i[0].score:0]})]})]})]})}var b=t(76535),v=t(39366),j=t(93019),N=t(8646),_=t(90597);function w(e){let{categoryScores:s,loading:t}=e,n=a.useMemo(()=>Object.entries(Object.keys(s).length>0?s:{"Business Foundation":57,"Banking & Finance":35,"Business Credit Profile":50,"Marketing Presence":67,Documentation:67}).map(e=>{let[s,t]=e;return{category:s.replace(" & ","\n& "),score:t,fullMark:100}}),[s]);return t?(0,r.jsx)("div",{className:"bg-white p-6 rounded-lg shadow",children:(0,r.jsxs)("div",{className:"animate-pulse",children:[(0,r.jsx)("div",{className:"h-4 bg-gray-200 rounded w-1/3 mb-4"}),(0,r.jsx)("div",{className:"h-64 bg-gray-200 rounded"})]})}):(0,r.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Category Performance"}),(0,r.jsx)("div",{className:"text-sm text-gray-500",children:"Scale: 0-100 points"})]}),(0,r.jsx)("div",{className:"h-80",children:(0,r.jsx)(m.h,{width:"100%",height:"100%",children:(0,r.jsxs)(b.H,{data:n,children:[(0,r.jsx)(v.n,{stroke:"#E5E7EB"}),(0,r.jsx)(j.I,{dataKey:"category",tick:{fill:"#374151",fontSize:12},className:"text-xs"}),(0,r.jsx)(N.S,{angle:90,domain:[0,100],tick:{fill:"#6B7280",fontSize:10}}),(0,r.jsx)(_.F,{name:"Your Score",dataKey:"score",stroke:"#3B82F6",fill:"#3B82F6",fillOpacity:.2,strokeWidth:2,dot:{fill:"#3B82F6",strokeWidth:1,r:4}})]})})}),(0,r.jsx)("div",{className:"mt-6 grid grid-cols-1 sm:grid-cols-2 gap-3",children:n.map((e,s)=>(0,r.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,r.jsx)("span",{className:"text-sm font-medium text-gray-700",children:e.category.replace("\n"," ")}),(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"w-12 h-2 bg-gray-200 rounded-full mr-2",children:(0,r.jsx)("div",{className:"h-2 rounded-full ".concat(e.score>=80?"bg-green-500":e.score>=60?"bg-yellow-500":e.score>=40?"bg-orange-500":"bg-red-500"),style:{width:"".concat(e.score,"%")}})}),(0,r.jsx)("span",{className:"text-sm font-bold text-gray-900",children:e.score})]})]},s))})]})}var D=t(77031),S=t(31699),k=t(20407);function C(e){let{userScore:s,industry:t="Technology",loading:n}=e,o=a.useMemo(()=>{let e={Technology:{average:72,top25:85,top10:92},Retail:{average:68,top25:82,top10:89},Manufacturing:{average:71,top25:84,top10:91},Healthcare:{average:74,top25:87,top10:94},"Financial Services":{average:76,top25:88,top10:95},"Professional Services":{average:73,top25:86,top10:93}},r=e[t]||e.Technology;return[{name:"Your Score",value:s,color:"#3B82F6"},{name:"Industry Average",value:r.average,color:"#6B7280"},{name:"Top 25%",value:r.top25,color:"#F59E0B"},{name:"Top 10%",value:r.top10,color:"#10B981"}]},[s,t]);if(n)return(0,r.jsx)("div",{className:"bg-white p-6 rounded-lg shadow",children:(0,r.jsxs)("div",{className:"animate-pulse",children:[(0,r.jsx)("div",{className:"h-4 bg-gray-200 rounded w-1/2 mb-4"}),(0,r.jsx)("div",{className:"h-48 bg-gray-200 rounded"})]})});let i=a.useMemo(()=>{let e=o[1].value,t=o[2].value;return s>=o[3].value?"Top 10%":s>=t?"Top 25%":s>=e?"Above Average":"Below Average"},[s,o]);return(0,r.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Industry Benchmark"}),(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsxs)("p",{className:"text-sm text-gray-500",children:[t," Industry"]}),(0,r.jsxs)("p",{className:"text-sm font-medium ".concat(i.includes("Top")?"text-green-600":"Above Average"===i?"text-blue-600":"text-orange-600"),children:["You're in the ",i]})]})]}),(0,r.jsx)("div",{className:"h-48",children:(0,r.jsx)(m.h,{width:"100%",height:"100%",children:(0,r.jsxs)(D.v,{data:o,layout:"horizontal",children:[(0,r.jsx)(g.q,{strokeDasharray:"3 3",stroke:"#E5E7EB"}),(0,r.jsx)(h.K,{type:"number",domain:[0,100],stroke:"#6B7280"}),(0,r.jsx)(p.B,{dataKey:"name",type:"category",stroke:"#6B7280",fontSize:12}),(0,r.jsx)(x.u,{contentStyle:{backgroundColor:"#F9FAFB",border:"1px solid #E5E7EB",borderRadius:"8px"},formatter:e=>["".concat(e," points"),"Score"]}),(0,r.jsx)(S.$,{dataKey:"value",radius:[0,4,4,0],children:o.map((e,s)=>(0,r.jsx)(k.b,{fill:e.color},"cell-".concat(s)))})]})})}),(0,r.jsxs)("div",{className:"mt-4 grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"p-3 bg-blue-50 rounded-lg",children:[(0,r.jsx)("p",{className:"text-sm text-blue-600 font-medium",children:"Gap to Top 25%"}),(0,r.jsxs)("p",{className:"text-lg font-bold text-blue-800",children:[Math.max(0,o[2].value-s)," points"]})]}),(0,r.jsxs)("div",{className:"p-3 bg-green-50 rounded-lg",children:[(0,r.jsx)("p",{className:"text-sm text-green-600 font-medium",children:"Gap to Top 10%"}),(0,r.jsxs)("p",{className:"text-lg font-bold text-green-800",children:[Math.max(0,o[3].value-s)," points"]})]})]})]})}function A(e){let{categoryScores:s,loading:t}=e,[n,o]=(0,a.useState)(()=>{let e=[];return Object.entries(s).forEach(s=>{let[t,r]=s;if(r<70)switch(t){case"Business Foundation":e.push({id:"bf-1",title:"Obtain EIN from IRS",category:t,priority:"high",impact:15,completed:!1}),e.push({id:"bf-2",title:"Register business with state",category:t,priority:"high",impact:12,completed:!1});break;case"Banking & Finance":e.push({id:"bf-3",title:"Open dedicated business bank account",category:t,priority:"high",impact:18,completed:!1}),e.push({id:"bf-4",title:"Set up business accounting system",category:t,priority:"medium",impact:10,completed:!1});break;case"Business Credit Profile":e.push({id:"bcp-1",title:"Apply for DUNS number",category:t,priority:"high",impact:20,completed:!1}),e.push({id:"bcp-2",title:"Establish trade credit accounts",category:t,priority:"medium",impact:15,completed:!1});break;case"Marketing Presence":e.push({id:"mp-1",title:"Create professional website",category:t,priority:"medium",impact:12,completed:!1}),e.push({id:"mp-2",title:"Set up Google My Business",category:t,priority:"low",impact:8,completed:!1})}}),e.sort((e,s)=>{let t={high:3,medium:2,low:1};return t[s.priority]-t[e.priority]})}),i=e=>{o(s=>s.map(s=>s.id===e?{...s,completed:!s.completed}:s))},c=n.filter(e=>e.completed).length,l=n.reduce((e,s)=>s.completed?e+s.impact:e,0);return t?(0,r.jsx)("div",{className:"bg-white p-6 rounded-lg shadow",children:(0,r.jsxs)("div",{className:"animate-pulse",children:[(0,r.jsx)("div",{className:"h-4 bg-gray-200 rounded w-1/3 mb-4"}),(0,r.jsx)("div",{className:"space-y-3",children:[1,2,3].map(e=>(0,r.jsx)("div",{className:"h-12 bg-gray-200 rounded"},e))})]})}):(0,r.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Improvement Actions"}),(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsxs)("p",{className:"text-sm text-gray-500",children:[c," of ",n.length," completed"]}),(0,r.jsxs)("p",{className:"text-sm font-medium text-green-600",children:["+",l," potential points"]})]})]}),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,r.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Overall Progress"}),(0,r.jsxs)("span",{className:"text-sm text-gray-500",children:[Math.round(c/n.length*100),"%"]})]}),(0,r.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-3",children:(0,r.jsx)("div",{className:"bg-gradient-to-r from-blue-500 to-green-500 h-3 rounded-full transition-all duration-300",style:{width:"".concat(c/n.length*100,"%")}})})]}),(0,r.jsx)("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:n.map(e=>(0,r.jsxs)("div",{className:"flex items-center p-3 rounded-lg border transition-all ".concat(e.completed?"bg-green-50 border-green-200":"bg-white border-gray-200 hover:bg-gray-50"),children:[(0,r.jsx)("input",{type:"checkbox",checked:e.completed,onChange:()=>i(e.id),className:"mr-3 h-4 w-4 text-blue-600 rounded focus:ring-blue-500"}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("p",{className:"text-sm font-medium ".concat(e.completed?"text-gray-500 line-through":"text-gray-900"),children:e.title}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-medium rounded-full ".concat("high"===e.priority?"bg-red-100 text-red-800":"medium"===e.priority?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"),children:e.priority}),(0,r.jsxs)("span",{className:"text-xs text-blue-600 font-medium",children:["+",e.impact,"pt"]})]})]}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:e.category})]})]},e.id))}),0===n.length&&(0,r.jsxs)("div",{className:"text-center py-8",children:[(0,r.jsx)("div",{className:"text-4xl mb-2",children:"\uD83C\uDF89"}),(0,r.jsx)("p",{className:"text-gray-500",children:"Great job! No immediate improvements needed."}),(0,r.jsx)("p",{className:"text-sm text-gray-400 mt-1",children:"Keep maintaining your excellent fundability score!"})]})]})}function E(){let{userProfile:e,latestAssessment:s,stats:t,loading:n,error:o,refresh:c}=function(){let[e,s]=(0,a.useState)({userProfile:null,latestAssessment:null,assessmentHistory:[],scoreTrend:[],loading:!0,error:null,stats:{totalAssessments:0,currentScore:0,scoreChange:0,lastAssessmentDate:null}});(0,a.useEffect)(()=>{t()},[]),(0,a.useEffect)(()=>{let e=()=>{console.log("\uD83D\uDD04 Dashboard refresh triggered, reloading data..."),setTimeout(()=>{t()},500)};return window.addEventListener("dashboardRefresh",e),()=>{window.removeEventListener("dashboardRefresh",e)}},[]),(0,a.useEffect)(()=>{let e=()=>{let e=localStorage.getItem("lastAssessmentResults");if(e)try{let s=JSON.parse(e),r=new Date(s.completedAt);(new Date().getTime()-r.getTime())/6e4<5&&(console.log("\uD83C\uDD95 Recent assessment detected, refreshing dashboard..."),t())}catch(e){console.error("Error parsing recent assessment results:",e)}};return e(),window.addEventListener("storage",e),()=>{window.removeEventListener("storage",e)}},[]);let t=async()=>{try{var e;console.log("\uD83D\uDCCA Loading dashboard data..."),s(e=>({...e,loading:!0,error:null}));let t=null,r=null,a=localStorage.getItem("demoUserId");if(a){console.log("\uD83D\uDD0D Loading data for user:",a);try{let{data:e}=await i.getLatestAssessment(a);e&&(console.log("✅ Got real assessment from database:",e),r=e);let s=await fetch("/api/user/profile?userId="+a);if(s.ok){let e=await s.json();e.success&&(t=e.data,console.log("✅ Got real user profile from database"))}}catch(e){console.warn("Database query failed, using localStorage:",e)}}if(!t||!r){let e=localStorage.getItem("lastAssessmentResults");if(e)try{let s=JSON.parse(e);console.log("\uD83D\uDCF1 Using localStorage data as fallback"),t=t||{id:a||"demo-user",email:"demo@ybwfunds.com",name:"Demo User",business_name:"Demo Business",fundability_score:s.currentScore,assessment_count:1,last_assessment_date:s.completedAt,created_at:new Date().toISOString(),updated_at:s.completedAt},r=r||{id:"local-assessment",user_id:t.id,overall_score:s.currentScore,category_scores:s.categoryScores,completion_percentage:100,status:"completed",assessment_version:"2.0",created_at:s.completedAt,updated_at:s.completedAt}}catch(e){console.error("Error parsing localStorage data:",e)}}let n=(null==r?void 0:r.overall_score)||0,o=(null==r?void 0:r.created_at)||null;console.log("\uD83D\uDCC8 Final dashboard data loaded:",{currentScore:n,lastAssessmentDate:o,source:(null==r?void 0:null===(e=r.id)||void 0===e?void 0:e.includes("local"))?"localStorage":"database"}),s({userProfile:t,latestAssessment:r,assessmentHistory:r?[r]:[],scoreTrend:[],loading:!1,error:null,stats:{totalAssessments:1,currentScore:n,scoreChange:0,lastAssessmentDate:o}})}catch(e){console.error("❌ Error loading dashboard data:",e),s(e=>({...e,loading:!1,error:"Unable to load dashboard data"}))}};return{...e,refresh:()=>{console.log("\uD83D\uDD04 Manual refresh triggered"),t()}}}();if(n)return(0,r.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(o)return(0,r.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[(0,r.jsx)("h3",{className:"text-red-800 font-semibold",children:"Error Loading Dashboard"}),(0,r.jsx)("p",{className:"text-red-600 mt-2",children:o}),(0,r.jsx)("button",{onClick:c,className:"mt-4 bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700",children:"Try Again"})]});let m=(null==s?void 0:s.category_scores)||{};return(0,r.jsxs)("div",{className:"space-y-8",children:[(0,r.jsxs)("div",{className:"bg-gradient-to-r from-blue-600 to-blue-800 text-white p-6 rounded-lg",children:[(0,r.jsxs)("h1",{className:"text-2xl font-bold",children:["Welcome back, ",(null==e?void 0:e.name)||"User","! \uD83D\uDE80"]}),(0,r.jsx)("p",{className:"mt-2 opacity-90",children:(null==e?void 0:e.business_name)?"Managing ".concat(e.business_name):"Track your business fundability progress"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,r.jsx)(d,{title:"Current Score",value:t.currentScore,change:t.scoreChange,icon:"\uD83D\uDCCA"}),(0,r.jsx)(d,{title:"Total Assessments",value:t.totalAssessments,icon:"\uD83D\uDCCB"}),(0,r.jsx)(d,{title:"Last Assessment",value:t.lastAssessmentDate?new Date(t.lastAssessmentDate).toLocaleDateString():"Never",icon:"\uD83D\uDCC5"}),(0,r.jsx)(d,{title:"Fundability Grade",value:M(t.currentScore),icon:"\uD83C\uDF93"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,r.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Current Score"}),(0,r.jsx)(l,{score:t.currentScore,size:200}),(0,r.jsxs)("div",{className:"mt-4 text-center",children:[(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:t.currentScore}),(0,r.jsxs)("p",{className:"text-gray-600",children:["Grade: ",M(t.currentScore)]})]})]}),(0,r.jsx)("div",{className:"lg:col-span-2",children:(0,r.jsx)(f,{data:[],loading:n})})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,r.jsx)(w,{categoryScores:m,loading:n}),(0,r.jsx)(C,{userScore:t.currentScore,industry:(null==e||e.business_name,"Technology"),loading:n})]}),(0,r.jsx)(A,{categoryScores:m,loading:n}),(0,r.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Quick Actions"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,r.jsxs)("button",{onClick:()=>window.location.href="/assessment",className:"bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors font-medium flex items-center justify-center",children:[(0,r.jsx)("span",{className:"mr-2",children:"\uD83D\uDCCA"}),"Take New Assessment"]}),(0,r.jsxs)("button",{className:"bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-colors font-medium flex items-center justify-center",children:[(0,r.jsx)("span",{className:"mr-2",children:"\uD83D\uDCA1"}),"View Recommendations"]}),(0,r.jsxs)("button",{onClick:()=>window.print(),className:"bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 transition-colors font-medium flex items-center justify-center",children:[(0,r.jsx)("span",{className:"mr-2",children:"\uD83D\uDCC4"}),"Download Report"]})]})]})]})}function M(e){return e>=90?"A - Excellent":e>=80?"B - Good":e>=70?"C - Fair":e>=60?"D - Poor":"F - Very Poor"}}},function(e){e.O(0,[883,971,117,744],function(){return e(e.s=75745)}),_N_E=e.O()}]);