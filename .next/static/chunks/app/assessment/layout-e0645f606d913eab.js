(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[878],{4201:function(e,t,r){Promise.resolve().then(r.bind(r,8386))},8386:function(e,t,r){"use strict";r.d(t,{AssessmentProvider:function(){return c},Y:function(){return l}});var s=r(7437),n=r(3655),o=r(2265);let a={currentStep:0,totalSteps:0,responses:{},currentScore:0,categoryScores:{},isComplete:!1,questions:[],loading:!1,error:null};function i(e,t){switch(t.type){case"INITIALIZE":return{...e,questions:t.questions,totalSteps:t.questions.length,currentStep:0,responses:{},currentScore:0,categoryScores:{},isComplete:!1};case"SET_RESPONSE":return{...e,responses:{...e.responses,[t.questionId]:t.value}};case"NEXT_STEP":return{...e,currentStep:Math.min(e.currentStep+1,e.totalSteps-1)};case"PREV_STEP":return{...e,currentStep:Math.max(e.currentStep-1,0)};case"SET_STEP":return{...e,currentStep:Math.max(0,Math.min(t.step,e.totalSteps-1))};case"UPDATE_SCORE":return{...e,currentScore:t.score,categoryScores:t.categoryScores};case"COMPLETE_ASSESSMENT":return{...e,isComplete:!0};case"RESET_ASSESSMENT":return{...a,questions:e.questions,totalSteps:e.questions.length};case"SET_LOADING":return{...e,loading:t.loading};case"SET_ERROR":return{...e,error:t.error};default:return e}}let u=(0,o.createContext)(void 0);function c(e){let{children:t}=e,[r,c]=(0,o.useReducer)(i,a),l=()=>{let e=Object.entries(r.responses).map(e=>{let[t,s]=e,n=r.questions.find(e=>e.id===t);return n?{category:n.category,criterionId:n.id,criterionName:n.question,responseValue:s,responseType:n.type,pointsEarned:function(e,t){switch(e.type){case"boolean":return!0===t?100:0;case"select":return({Excellent:100,"Very Good":85,Good:70,Fair:55,Poor:25,Yes:100,No:0,Corporation:100,LLC:85,Partnership:60,"Sole Proprietorship":40})[t]||0;case"number":if(e.id.includes("revenue")){let e=parseFloat(t)||0;if(e>=1e6)return 100;if(e>=5e5)return 85;if(e>=25e4)return 70;if(e>=1e5)return 55;if(e>=5e4)return 40;return 25}if(e.id.includes("years")||e.id.includes("time")){let e=parseFloat(t)||0;if(e>=5)return 100;if(e>=3)return 80;if(e>=2)return 60;if(e>=1)return 40;return 20}return t>0?75:0;case"text":return t&&t.trim()?80:0;default:return 0}}(n,s),pointsPossible:100,weightFactor:n.weight,isCritical:n.isCritical}:null}).filter(Boolean),t=e.reduce((e,t)=>e+t.pointsEarned,0),s=100*e.length,n={};Object.entries(e.reduce((e,t)=>(e[t.category]||(e[t.category]=[]),e[t.category].push(t),e),{})).forEach(e=>{let[t,r]=e,s=r.reduce((e,t)=>e+t.pointsEarned,0),o=100*r.length;n[t]=o>0?s/o*100:0}),c({type:"UPDATE_SCORE",score:Math.round(s>0?t/s*100:0),categoryScores:n})},S=async()=>{try{c({type:"SET_LOADING",loading:!0}),c({type:"COMPLETE_ASSESSMENT"}),c({type:"SET_LOADING",loading:!1})}catch(e){c({type:"SET_ERROR",error:e instanceof Error?e.message:"Unknown error"}),c({type:"SET_LOADING",loading:!1})}},p=async()=>{try{console.log("\uD83D\uDCBE Saving assessment and updating dashboard..."),c({type:"SET_LOADING",loading:!0});let e={responses:r.responses,currentScore:r.currentScore,categoryScores:r.categoryScores,completedAt:new Date().toISOString(),questions:r.questions};localStorage.setItem("lastAssessmentResults",JSON.stringify(e)),console.log("✅ Saved to localStorage:",e);try{let{data:e}=await n.KD.getCurrentUserProfile();e&&(console.log("\uD83D\uDC64 Updating user profile..."),await n.KD.updateFundabilityScore(e.id,r.currentScore),await n.KD.incrementAssessmentCount(e.id),console.log("✅ Database updated successfully"))}catch(e){console.warn("⚠️ Database update failed, but localStorage saved:",e)}return console.log("\uD83D\uDD14 Triggering dashboard refresh..."),window.dispatchEvent(new CustomEvent("dashboardRefresh")),setTimeout(()=>{window.dispatchEvent(new CustomEvent("dashboardRefresh"))},100),window.dispatchEvent(new StorageEvent("storage",{key:"lastAssessmentResults",newValue:JSON.stringify(e)})),c({type:"SET_LOADING",loading:!1}),!0}catch(e){return console.error("❌ Error saving assessment:",e),c({type:"SET_LOADING",loading:!1}),!1}};return(0,s.jsx)(u.Provider,{value:{state:r,dispatch:c,setResponse:(e,t)=>{c({type:"SET_RESPONSE",questionId:e,value:t}),setTimeout(()=>l(),100)},nextStep:()=>{c({type:"NEXT_STEP"})},prevStep:()=>{c({type:"PREV_STEP"})},goToStep:e=>{c({type:"SET_STEP",step:e})},calculateScore:l,completeAssessment:S,resetAssessment:()=>{c({type:"RESET_ASSESSMENT"})},saveAndUpdateDashboard:p,getReportData:()=>({responses:r.responses,currentScore:r.currentScore,categoryScores:r.categoryScores,questions:r.questions,completedQuestions:Object.keys(r.responses).length})},children:t})}function l(){let e=(0,o.useContext)(u);if(void 0===e)throw Error("useAssessment must be used within an AssessmentProvider");return e}}},function(e){e.O(0,[580,655,971,117,744],function(){return e(e.s=4201)}),_N_E=e.O()}]);